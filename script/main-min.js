!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this._gl=t}return o(e,[{key:"gl",get:function(){return this._gl}}]),e}();t.a=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(0),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},c=function(e){function t(e,n,i){r(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u.id=e.createFramebuffer(),u.width=n,u.height=i,u}return i(t,e),a(t,[{key:"bind",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this);r.bindFramebuffer(r.FRAMEBUFFER,this.id),r.viewport(0,0,this.width,this.height);for(var o=0;o<e.length;++o)r.framebufferTexture2D(r.FRAMEBUFFER,r["COLOR_ATTACHMENT"+o],r.TEXTURE_2D,e[o],0);n&&(r.bindRenderbuffer(r.RENDERBUFFER,n),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,n))}},{key:"freeGLResources",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this).deleteFramebuffer(this.id),this.id=null}}],[{key:"bindDefault",value:function(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)}}]),t}(u.a);t.a=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){l=new c(e)}function i(e){function t(e,t,n){e.addEventListener(n,t,!1),t()}!function(){var n=function(t,n){n.checked&&e.reset(t,t)},r=[128,256,512],o=!0,i=!1,u=void 0;try{for(var a,s=r[Symbol.iterator]();!(o=(a=s.next()).done);o=!0)!function(){var e=a.value,r="resolution-"+e+"-button",o=document.getElementById(r);t(o,function(){n(e,o)},"change")}()}catch(e){i=!0,u=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw u}}}();var n=document.getElementById("float-checkbox");if(!a.a){n.disabled=!0,n.checked=!1;var r=document.getElementById("float-label");r.innerHTML="(extensions not available)",r.style.color="#999999"}t(n,function(){e.useFloatTextures=n.checked},"change");var o=document.getElementById("iterations-slider");t(o,function(){e.minNbIterations=+o.value},"input");var i=document.getElementById("timestep-slider");t(i,function(){e.timestep=+i.value},"input");var u=document.getElementById("stream-checkbox");t(u,function(){d.stream=u.checked},"change"),function(){var e=function(e,t){t.checked&&(v=e)},n=["none","one","many"],r=!0,o=!1,i=void 0;try{for(var u,a=n[Symbol.iterator]();!(r=(u=a.next()).done);r=!0)!function(){var n=u.value,r="obstacles-"+n+"-button",o=document.getElementById(r);t(o,function(){e(n,o)},"change")}()}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}}();var s=document.getElementById("brush-radius-slider");t(s,function(){f.radius=+s.value},"input");var c=document.getElementById("brush-strength-slider");t(c,function(){f.strength=+c.value},"input");var l=document.getElementById("color-intensity-slider");t(l,function(){e.colorIntensity=+l.value},"input");var p=document.getElementById("color-checkbox");t(p,function(){e.color=p.checked},"change");var _=document.getElementById("display-velocity-button");t(_,function(){h.velocity=_.checked},"change");var y=document.getElementById("display-pressure-button");t(y,function(){h.pressure=y.checked},"change");var b=document.getElementById("obstacles-checkbox");t(b,function(){h.obstacles=b.checked},"change")}function u(e,t){i(t),o(e)}n.d(t,"e",function(){return l}),n.d(t,"a",function(){return u}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return h}),n.d(t,"f",function(){return v}),n.d(t,"d",function(){return d});var a=n(6),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(t){r(this,e),this.elt=t,this._posInPx=[0,0],this._pivotInPx=[0,0],this.setPosInPx([0,0]),this.setMovementInPx([0,0]);var n=this,o=function(e){var t=[e.clientX,e.clientY];n.setPosInPx(n.documentToElement(t))},i=function(){n.pressed=!0,n.setMovementInPx([0,0]),n._pivotInPx=n._posInPx},u=function(){n.pressed=!1};document.addEventListener("mousemove",o,!1),t.addEventListener("mousedown",i,!1),document.addEventListener("mouseup",u,!1)}return s(e,[{key:"setPosInPx",value:function(e){var t=[this._pivotInPx[0]-e[0],this._pivotInPx[1]-e[1]],n=Math.sqrt(t[0]*t[0]+t[1]*t[1]);n>16&&(t[0]*=16/n,t[1]*=16/n,this._pivotInPx[0]=e[0]+t[0],this._pivotInPx[1]=e[1]+t[1]);var r=[-t[0]/16,-t[1]/16];this.setMovementInPx(r),this._posInPx=e,this._pos=this.setRelative(e)}},{key:"setMovementInPx",value:function(e){this._movementInPx=e,this._movement=this.setRelative(e)}},{key:"setRelative",value:function(e){return[e[0]/this.elt.clientWidth,e[1]/this.elt.clientHeight]}},{key:"documentToElement",value:function(e){var t=this.elt.getBoundingClientRect();return[e[0]-t.left,this.elt.clientHeight-(e[1]-t.top)]}},{key:"posInPx",get:function(){return this._posInPx}},{key:"pos",get:function(){return this._pos}},{key:"movementInPx",get:function(){return this._movementInPx}},{key:"movement",get:function(){return this._movement}}]),e}(),l=new c(document.body),f={radius:10,strength:100},d={stream:!0},v="none",h={velocity:!0,pressure:!0,brush:!0,obstacles:!0}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,n){alert("NOT IMPLEMENTED YET")}function a(e,t,n){Array.isArray(n)?e.uniform1fv(t,n):e.uniform1f(t,n)}function s(e,t,n){e.uniform2fv(t,n)}function c(e,t,n){e.uniform3fv(t,n)}function l(e,t,n){e.uniform4fv(t,n)}function f(e,t,n){Array.isArray(n),e.uniform1iv(t,n)}function d(e,t,n){e.uniform2iv(t,n)}function v(e,t,n){e.uniform3iv(t,n)}function h(e,t,n){e.uniform4iv(t,n)}function p(e,t,n){e.uniform1i(t,+n)}function _(e,t,n){e.uniform2iv(t,n)}function y(e,t,n){e.uniform3iv(t,n)}function b(e,t,n){e.uniform4iv(t,n)}function m(e,t,n){e.uniformMatrix2fv(t,!1,n)}function E(e,t,n){e.uniformMatrix3fv(t,!1,n)}function g(e,t,n){e.uniformMatrix4fv(t,!1,n)}function x(e,t,n,r){e.uniform1i(t,n),e.activeTexture(e["TEXTURE"+n]),e.bindTexture(e.TEXTURE_2D,r)}function T(e,t,n,r){e.uniform1i(t,n),e.activeTexture(e["TEXTURE"+n]),e.bindTexture(e.TEXTURE_CUBE_MAP,r)}var P=n(0),O=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),I=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},R={35664:{str:"FLOAT_VEC2",binder:s},35665:{str:"FLOAT_VEC3",binder:c},35666:{str:"FLOAT_VEC4",binder:l},35667:{str:"INT_VEC2",binder:d},35668:{str:"INT_VEC3",binder:v},35669:{str:"INT_VEC4",binder:h},35670:{str:"BOOL",binder:p},35671:{str:"BOOL_VEC2",binder:_},35672:{str:"BOOL_VEC3",binder:y},35673:{str:"BOOL_VEC4",binder:b},35674:{str:"FLOAT_MAT2",binder:m},35675:{str:"FLOAT_MAT3",binder:E},35676:{str:"FLOAT_MAT4",binder:g},35678:{str:"SAMPLER_2D",binder:x},35680:{str:"SAMPLER_CUBE",binder:T},5120:{str:"BYTE",binder:u},5121:{str:"UNSIGNED_BYTE",binder:u},5122:{str:"SHORT",binder:u},5123:{str:"UNSIGNED_SHORT",binder:u},5124:{str:"INT",binder:f},5125:{str:"UNSIGNED_INT",binder:u},5126:{str:"FLOAT",binder:a}},S=function(e){function t(e,n,i){function u(t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.log(e.getShaderInfoLog(r)),e.deleteShader(r),null)}r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.id=null,a.uCount=0,a.aCount=0;var s=u(e.VERTEX_SHADER,n),c=u(e.FRAGMENT_SHADER,i),l=e.createProgram();return e.attachShader(l,s),e.attachShader(l,c),e.linkProgram(l),e.getProgramParameter(l,e.LINK_STATUS)?(a.id=l,a.introspection()):(console.log(e.getProgramInfoLog(l)),e.deleteProgram(l)),a}return i(t,e),O(t,[{key:"freeGLResources",value:function(){I(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this).deleteProgram(this.id),this.id=null}},{key:"introspection",value:function(){var e=I(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this);this.uCount=e.getProgramParameter(this.id,e.ACTIVE_UNIFORMS),this.u=[];for(var n=0;n<this.uCount;++n){var r=e.getActiveUniform(this.id,n),o=r.name;this.u[o]={value:null,loc:e.getUniformLocation(this.id,o),size:r.size,type:r.type}}this.aCount=e.getProgramParameter(this.id,e.ACTIVE_ATTRIBUTES),this.a=[];for(var i=0;i<this.aCount;++i){var u=e.getActiveAttrib(this.id,i),a=u.name;this.a[a]={VBO:null,loc:e.getAttribLocation(this.id,a),size:u.size,type:u.type}}}},{key:"use",value:function(){I(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this).useProgram(this.id)}},{key:"bindUniforms",value:function(){var e=I(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),n=0;for(var r in this.u){var o=this.u[r];if(null!==o.value)if(35678===o.type||35680===o.type){var i=n;R[o.type].binder(e,o.loc,i,o.value),n++}else R[o.type].binder(e,o.loc,o.value)}}},{key:"bindAttributes",value:function(){for(var e in this.a){var t=this.a[e];null!==t.VBO&&t.VBO.bind(t.loc)}}},{key:"bindUniformsAndAttributes",value:function(){this.bindUniforms(),this.bindAttributes()}}]),t}(P.a);t.a=S},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(0),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},c=function(e){function t(e,n,i,u){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.id=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a.id),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),a.size=i,a.type=u,a.normalize=!1,a.stride=0,a.offset=0,a}return i(t,e),a(t,[{key:"freeGLResources",value:function(){this.gl.deleteBuffer(this.id),this.id=null}},{key:"bind",value:function(e){var n=s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this);n.enableVertexAttribArray(e),n.bindBuffer(n.ARRAY_BUFFER,this.id),n.vertexAttribPointer(e,this.size,this.type,this.normalize,this.stride,this.offset)}}],[{key:"createQuad",value:function(e,n,r,o,i){var u=[n,r,o,r,n,i,o,i];return new t(e,new Float32Array(u),2,e.FLOAT)}}]),t}(u.a);t.a=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return i});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){r(this,e),this.vert=t,this.frag=n}return o(e,[{key:"batchReplace",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var u=o.value;this.vert=this.vert.replace(new RegExp(u.toReplace),u.replacement),this.frag=this.frag.replace(new RegExp(u.toReplace),u.replacement)}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}}],[{key:"fromScript",value:function(t,n){return new e(document.getElementById(t).text,document.getElementById(n).text)}}]),e}()},function(e,t,n){"use strict";function r(e){return!(e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision<23&&(alert("Your device only supports low precision float in fragment shader.\nThe simulation will not run."),1))}function o(e,t){i=!0;var n=!0,r=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(n=(u=a.next()).done);n=!0){var s=u.value;e.getExtension(s)||(console.log("Couldn't load WebGL extension '"+s+"'."),i=!1)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return i});var i=!1},function(e,t,n){"use strict";function r(e){var t=new i.a(e,l.vert,l.frag);return t.a.aCorner.VBO=u.a.createQuad(e,0,0,1,1),t}function o(e){var t=new i.a(e,f.vert,f.frag);return t.a.aCorner.VBO=u.a.createQuad(e,-1,-1,1,1),t}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return s});var i=n(3),u=n(4),a=n(5),s="vec4 encodeObstacle(vec2 normal) {\n  normal = clamp(normalize(normal), -1.0, 1.0);\n  return vec4(0.5 * normal + 0.5, 0, 0);\n}\nvec2 decodeObstacle(vec4 texel) {\n  return 2.0 * texel.rg - 1.0;\n}",c=[{toReplace:"___ENCODING___",replacement:s}],l=new a.a("attribute vec2 aCorner; //{0,1}x{0,1}\n\nvarying vec2 sampleCoords;\n\nvoid main(void) {\n    sampleCoords = aCorner;\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\n}","precision mediump float;\n\nuniform sampler2D uObstacles;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\nvoid main(void) {\n    vec2 obstacle = decodeObstacle(texture2D(uObstacles, sampleCoords));\n    if (dot(obstacle, obstacle) < 0.5)\n        discard;\n\n    gl_FragColor = vec4(0.5*obstacle + 0.5, 0, 0);\n}");l.batchReplace(c);var f=new a.a("uniform vec2 uSize; //relative, in [0,1]x[0,1]\nuniform vec2 uPos; //relative, in [0,1]x[0,1]\n\nattribute vec2 aCorner; //in {-1,+1}x{-1,+1}\n\nvarying vec2 toCenter;\n\nvoid main(void) {\n    toCenter = -aCorner;\n\n    vec2 pos = uPos + aCorner * uSize;\n\n    gl_Position = vec4(2.0 * pos - 1.0, 0, 1);\n}","precision mediump float;\n\nvarying vec2 toCenter;\n\n___ENCODING___\n\nvoid main(void) {\n    float dist = length(toCenter);\n    if (dist > 1.0)\n        discard;\n\n    vec2 normal = -toCenter / dist;\n    gl_FragColor = encodeObstacle(normal);\n}");f.batchReplace(c)},function(e,t,n){"use strict";function r(e,t){var n=e.getContext("webgl",t);if(!n){if(!(n=e.getContext("experimental-webgl",t)))return alert("Your browser or device does not seem to support WebGL."),null;alert("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return n&&(e.style.cursor="none",n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.BLEND),n.clearColor(0,0,0,1),o.a(n,!1)),n}Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),i=n(1),u=n(2),a=n(10),s=n(12),c=n(13),l=n(6);!function(){function e(t){t*=.001;var r=t-g;b=1/r,g=t,r=Math.min(r,.1);var o=v[u.f];u.d.stream&&f.addVel([.1,.5],[.05,.2],[.4,0]),f.update(o),i.a.bindDefault(n),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),u.c.velocity?f.drawVelocity():u.c.pressure&&f.drawPressure(),u.c.brush&&d.draw(),u.c.obstacles&&o.draw(),u.c.velocity&&u.c.pressure&&(n.viewport(10,10,128,128),f.drawPressure()),requestAnimationFrame(e)}var t=document.getElementById("glcanvas"),n=r(t,{alpha:!1});if(n&&l.b(n)){var o=["OES_texture_float","WEBGL_color_buffer_float","OES_texture_float_linear"];l.c(n,o);var f=new c.a(n,256,256),d=new a.a(n),v=[];v.none=new s.a(n,256,256),v.one=new s.a(n,256,256),v.one.addObstacle([.015,.015],[.3,.5]),v.many=new s.a(n,256,256);for(var h=[.012,.012],p=0;p<5;++p)for(var _=-p/2;_<=p/2;++_){h=[h[0]+5e-4,h[1]+5e-4];var y=[.3+.07*p,.5+.08*_];v.many.addObstacle(h,y)}u.a(t,f);var b=0,m=document.getElementById("fps-text"),E=function(){m.textContent=b.toFixed(0)};setInterval(E,1e3);var g=0;requestAnimationFrame(e)}}()},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?window.devicePixelRatio:1,r=Math.floor(e.canvas.clientWidth*n),o=Math.floor(e.canvas.clientHeight*n);e.canvas.width==r&&e.canvas.height==o||(e.canvas.width=r,e.canvas.height=o)}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(0),a=n(2),s=n(11),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},f=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._drawShader=s.a(e),n.thickness=2,n}return i(t,e),c(t,[{key:"freeGLResources",value:function(){this._drawShader.freeGLResources()}},{key:"draw",value:function(){var e=l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),n=[e.canvas.clientWidth,e.canvas.clientHeight],r=this._drawShader;r.use();var o=[a.b.radius/n[0],a.b.radius/n[1]];r.u.uBrushSize.value=o,r.u.uBrushPos.value=a.e.pos,r.u.uThickness.value=this.thickness/a.b.radius,r.bindUniformsAndAttributes(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}}]),t}(u.a);t.a=f},function(e,t,n){"use strict";function r(e){var t=new o.a(e,a.vert,a.frag);return t.a.aCorner.VBO=i.a.createQuad(e,-1,-1,1,1),t}n.d(t,"a",function(){return r});var o=n(3),i=n(4),u=n(5),a=new u.a("uniform vec2 uBrushSize; //relative, in [0,1]x[0,1]\nuniform vec2 uBrushPos; //relative, in [0,1]x[0,1]\n\nattribute vec2 aCorner; //in {-1,+1}x{-1,+1}\n\nvarying vec2 toCenter;\n\nvoid main(void) {\n    toCenter = -aCorner;\n\n    vec2 pos = uBrushPos + aCorner * uBrushSize;\n\n    gl_Position = vec4(2.0 * pos - 1.0, 0, 1);\n}","precision mediump float;\n\nuniform float uThickness; //relative to brushRadius\n\nvarying vec2 toCenter;\n\nvoid main(void) {\n    float dist = length(toCenter);\n    if (dist < 1.0-uThickness || dist > 1.0)\n        discard;\n\n    const vec3 color = vec3(1);\n\n    gl_FragColor = vec4(color, 1.0);\n}")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(0),a=n(1),s=n(7),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},f=function(e){function t(e,n,i){r(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u._width=n,u._height=i,u._fbo=new a.a(e,n,i),u._drawShader=s.b(e),u._addShader=s.a(e),u.initObstaclesMap(),u}return i(t,e),c(t,[{key:"freeGLResources",value:function(){var e=l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this);this._fbo.freeGLResources(),this._fbo=null,e.deleteTexture(this._texture),e.deleteTexture(this._initTexture),this._drawShader.freeGLResources(),this._addShader.freeGLResources(),this._drawShader=null,this._addShader=null}},{key:"draw",value:function(){var e=l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),n=this._drawShader;n.u.uObstacles.value=this.texture,n.use(),n.bindUniformsAndAttributes(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},{key:"addObstacle",value:function(e,n){var r=l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),o=this._addShader;o.u.uSize.value=e,o.u.uPos.value=n,this._fbo.bind([this._texture]),o.use(),o.bindUniformsAndAttributes(),r.drawArrays(r.TRIANGLE_STRIP,0,4)}},{key:"initObstaclesMap",value:function(){for(var e=l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),n=this._width,r=this._height,o=[],i=0;i<r;++i)for(var u=0;u<n;++u)0===i?o.push.apply(o,[127,255,0,255]):i===r-1?o.push.apply(o,[127,0,0,255]):0===u?o.push.apply(o,[255,127,0,255]):u===n-1?o.push.apply(o,[0,127,0,255]):o.push.apply(o,[127,127,0,255]);for(var a=new Uint8Array(o),s=[],c=0;c<2;++c){var f=e.createTexture();e.bindTexture(e.TEXTURE_2D,f),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,r,0,e.RGBA,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s.push(f)}e.bindTexture(e.TEXTURE_2D,null),this._texture=s[0],this._initTexture=s[1]}},{key:"texture",get:function(){return this._texture}}]),t}(u.a);t.a=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=n(0),a=n(1),s=n(2),c=n(14),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},d=function(e){function t(e,n,i){r(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u._useFloatTextures=!1,u.viscosity=2e-4,u.colorIntensity=.033,u.color=!0,u.reset(n,i),u}return i(t,e),l(t,[{key:"freeGLResources",value:function(){this._FBO&&this._FBO.freeGLResources(),this.freeTextures(),this.freeShaders()}},{key:"freeTextures",value:function(){var e=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this);this._velTextures&&(e.deleteTexture(this._velTextures[0]),e.deleteTexture(this._velTextures[1])),e.deleteTexture(this._tmpTexture),e.deleteTexture(this._pressureTexture),e.deleteTexture(this._divergenceTexture)}},{key:"freeShaders",value:function(){function e(e){e&&e.freeGLResources()}e(this._drawVelocityShader),e(this._drawPressureShader),e(this._addVelShader),e(this._advectShader),e(this._jacobiPressureShader),e(this._divergenceShader),e(this._substractGradientShader),e(this._obstaclesVelocityShader)}},{key:"reset",value:function(e,n){this.freeGLResources(),this._width=e,this._height=n,this.dx=1/Math.min(e,n),this._FBO=new a.a(f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),e,n),this.initTextures(),this.buildShaders(),this._currIndex=0}},{key:"update",value:function(e){var n=this.timestep;if(f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this).clearColor(.5,0,.5,0),s.e.pressed){var r=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),o=[r.canvas.clientWidth,r.canvas.clientHeight],i=[s.b.radius/o[0],s.b.radius/o[1]],u=s.e.pos,a=[s.e.movement[0]*s.b.strength,s.e.movement[1]*s.b.strength];this.addVel(u,i,a)}this.advect(n),this.obstaclesVelocity(e),this.project(e),this.obstaclesVelocity(e)}},{key:"addVel",value:function(e,t,n){var r=this.gl,o=this._addVelShader;o.u.uVel.value=this._velTextures[this.currIndex],o.u.uBrushPos.value=e,o.u.uBrushSize.value=t,o.u.uAddVel.value=n,o.use(),this._FBO.bind([this._velTextures[this.nextIndex]]),o.bindUniformsAndAttributes(),r.drawArrays(r.TRIANGLE_STRIP,0,4),this.switchBuffers()}},{key:"drawVelocity",value:function(){var e=this.gl,t=this._drawVelocityShader;t.u.uVel.value=this._velTextures[this.currIndex],t.u.uColorIntensity.value=this.colorIntensity,t.u.uBlacknWhite.value=!this.color,t.use(),t.bindUniformsAndAttributes(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},{key:"drawPressure",value:function(){var e=this.gl,t=this._drawPressureShader;t.u.uPressure.value=this._pressureTexture,t.u.uColorIntensity.value=this.colorIntensity,t.u.uBlacknWhite.value=!this.color,t.use(),t.bindUniformsAndAttributes(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},{key:"switchBuffers",value:function(){this._currIndex=this.nextIndex}},{key:"obstaclesVelocity",value:function(e){var t=this.gl,n=this._obstaclesVelocityShader;n.u.uVelocities.value=this._velTextures[this.currIndex],n.u.uObstacles.value=e.texture,n.u.uTexelSize.value=this.texelSize,this._FBO.bind([this._velTextures[this.nextIndex]]),n.use(),n.bindUniformsAndAttributes(),t.drawArrays(t.TRIANGLE_STRIP,0,4),this.switchBuffers()}},{key:"advect",value:function(e){var t=this.gl,n=this._advectShader;n.u.uVelUnit.value=[128/this._width,128/this._height],n.u.uDt.value=e,n.u.uQuantity.value=this._velTextures[this.currIndex],n.u.uVel.value=this._velTextures[this.currIndex],this._FBO.bind([this._velTextures[this.nextIndex]]),n.use(),n.bindUniformsAndAttributes(),t.drawArrays(t.TRIANGLE_STRIP,0,4),this.switchBuffers()}},{key:"computeDivergence",value:function(){var e=this.gl,t=this._divergenceShader;t.u.uTexelSize.value=this.texelSize,t.u.uVelocity.value=this._velTextures[this.currIndex],this._FBO.bind([this._divergenceTexture]),e.clear(e.COLOR_BUFFER_BIT),t.use(),t.bindUniformsAndAttributes(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},{key:"computePressure",value:function(e){var t=this.gl,n=this._jacobiPressureShader,r=-.5*this.dx,o=this._pressureTexture,i=this._divergenceTexture;n.u.uTexelSize.value=this.texelSize,n.u.uAlpha.value=r,n.u.uInvBeta.value=.25,n.u.uConstantTerm.value=i,n.u.uObstacles.value=e.texture;var u=0,a=[this._tmpTexture,o];this._FBO.bind([this._tmpTexture]),t.clear(t.COLOR_BUFFER_BIT),n.use(),n.bindAttributes();for(var s=0;s<this._nbIterations;++s)n.u.uPrevIter.value=a[u],this._FBO.bind([a[(u+1)%2]]),n.bindUniforms(),t.drawArrays(t.TRIANGLE_STRIP,0,4),u=(u+1)%2}},{key:"substractPressureGradient",value:function(){var e=this.gl,t=this._substractGradientShader;t.u.uVelocities.value=this._velTextures[this.currIndex],t.u.uPressure.value=this._pressureTexture,t.u.uTexelSize.value=this.texelSize,t.u.uHalfInvDx.value=.5/this.dx,this._FBO.bind([this._velTextures[this.nextIndex]]),t.use(),t.bindUniformsAndAttributes(),e.drawArrays(e.TRIANGLE_STRIP,0,4),this.switchBuffers()}},{key:"project",value:function(e){this.computeDivergence(),this.computePressure(e),this.substractPressureGradient()}},{key:"initTextures",value:function(){this.freeTextures();for(var e=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this),n=this._width,r=this._height,o=[],i=0;i<4*n*r;++i)o.push(0);for(var u=new Float32Array(o),a=[],s=0;s<4*n*r;++s)a.push(127);for(var c=new Uint8Array(a),l=this._useFloatTextures?e.FLOAT:e.UNSIGNED_BYTE,d=this._useFloatTextures?u:c,v=[],h=0;h<2;++h){var p=e.createTexture();e.bindTexture(e.TEXTURE_2D,p),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,r,0,e.RGBA,l,d),v.push(p)}for(var _=0;_<3;++_){var y=e.createTexture();e.bindTexture(e.TEXTURE_2D,y),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,r,0,e.RGBA,e.UNSIGNED_BYTE,c),v.push(y)}var b=!0,m=!1,E=void 0;try{for(var g,x=v[Symbol.iterator]();!(b=(g=x.next()).done);b=!0){var T=g.value;e.bindTexture(e.TEXTURE_2D,T),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}}catch(e){m=!0,E=e}finally{try{!b&&x.return&&x.return()}finally{if(m)throw E}}e.bindTexture(e.TEXTURE_2D,null),this._velTextures=[v[0],v[1]],this._tmpTexture=v[2],this._pressureTexture=v[3],this._divergenceTexture=v[4]}},{key:"buildShaders",value:function(){this.freeShaders(),c.i(this._useFloatTextures);var e=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"gl",this);this._drawVelocityShader=c.e(e),this._drawPressureShader=c.d(e),this._addVelShader=c.a(e),this._advectShader=c.b(e),this._jacobiPressureShader=c.f(e),this._divergenceShader=c.c(e),this._substractGradientShader=c.h(e),this._obstaclesVelocityShader=c.g(e)}},{key:"useFloatTextures",set:function(e){e!==this._useFloatTextures&&(this._useFloatTextures=e,this.reset(this._width,this._height))}},{key:"minNbIterations",set:function(e){this._nbIterations=2*Math.ceil(e/2)+1}},{key:"texelSize",get:function(){return[1/this._width,1/this._height]}},{key:"velTexture",get:function(){return this._velTextures[this.currIndex]}},{key:"currIndex",get:function(){return this._currIndex}},{key:"nextIndex",get:function(){return(this._currIndex+1)%2}}]),t}(u.a);t.a=d},function(e,t,n){"use strict";function r(e){var t=e?b:m;g=y.replace(/___ENCODING_VELOCITY___/g,t),g=g.replace(/___ENCODING_OBSTACLES___/g,_.c)}function o(e,t){var n=t.vert,r=t.frag.replace(/___ENCODING___/g,g),o=new v.a(e,n,r);return o.a.aCorner.VBO=h.a.createQuad(e,0,0,1,1),o}function i(e){return o(e,x)}function u(e){return o(e,T)}function a(e){return o(e,P)}function s(e){return o(e,O)}function c(e){return o(e,I)}function l(e){return o(e,R)}function f(e){return o(e,S)}function d(e){return o(e,w)}n.d(t,"e",function(){return i}),n.d(t,"d",function(){return u}),n.d(t,"a",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"f",function(){return c}),n.d(t,"c",function(){return l}),n.d(t,"h",function(){return f}),n.d(t,"g",function(){return d}),n.d(t,"i",function(){return r});var v=n(3),h=n(4),p=n(5),_=n(7),y="const float MAX_SPEED = 1.0;\nconst float SPEED_BANDWIDTH = 2.01 * MAX_SPEED;\n\nconst float MIN_DIVERGENCE = -4.0 * MAX_SPEED;\nconst float MAX_DIVERGENCE =  4.0 * MAX_SPEED;\nconst float DIVERGENCE_BANDWIDTH = MAX_DIVERGENCE - MIN_DIVERGENCE;\n\nconst float MIN_PRESSURE = 0.5 * MIN_DIVERGENCE;\nconst float MAX_PRESSURE = 0.5 * MAX_DIVERGENCE;\nconst float PRESSURE_BANDWIDTH = MAX_PRESSURE - MIN_PRESSURE;\n\n/* Decodes a float value (32 bits in [0,1])\n * from a 4D value (4x8bits in [0,1]x[0,1]x[0,1]x[0,1]) */\nfloat decode32bit(vec4 v)\n{\n    const vec4 weights = 255.0 * vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0) / (256.0*256.0*256.0*256.0 - 1.0);\n    return dot(weights, v);\n}\n\n/* Encodes a float value (32 bits in [0,1])\n * into a 4D value (4x8bits in [0,1]x[0,1]x[0,1]x[0,1]) */\nvec4 encode32bit(float f)\n{\n    const vec4 base = (256.0*256.0*256.0*256.0 - 1.0) / vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n    return floor(mod(f * base, 256.0)) / 255.0;\n}\n\n/* Decodes a float value (16 bits in [0,1])\n * from a 2D value (2x8bits in [0,1]x[0,1]) */\nfloat decode16bit(vec2 v)\n{\n    const vec2 weights = 255.0 * vec2(256.0, 1.0) / (256.0*256.0 - 1.0);\n    return dot(weights, v);\n}\n\n/* Encodes a float value (16 bits in [0,1])\n * into a 2D value (2x8bits in [0,1]x[0,1]) */\nvec2 encode16bit(float f)\n{\n    const vec2 base = (256.0*256.0 - 1.0) / vec2(256.0, 1.0);\n    return floor(mod(f * base, 256.0)) / 255.0;\n}\n\nfloat decodeDivergence(vec4 texel) {\n    float div = decode32bit(texel);\n    return div * DIVERGENCE_BANDWIDTH + MIN_DIVERGENCE;\n}\nvec4 encodeDivergence(float div) {\n    div = (div - MIN_DIVERGENCE) / DIVERGENCE_BANDWIDTH;\n    return encode32bit(div);\n}\n\nfloat decodePressure(vec4 texel) {\n    float p = decode32bit(texel);\n    return p * PRESSURE_BANDWIDTH + MIN_PRESSURE;\n}\nvec4 encodePressure(float p) {\n    p = (p - MIN_PRESSURE) / PRESSURE_BANDWIDTH;\n    return encode32bit(p);\n}\n\n___ENCODING_VELOCITY___\n\n___ENCODING_OBSTACLES___",b="vec4 encodeVelocity(vec2 vel) {\n    return vec4(vel, 0, 0);\n}\nvec2 decodeVelocity(vec4 texel) {\n    return texel.rg;\n}",m="vec4 encodeVelocity(vec2 vel) {\n    vel = 0.5 * (vel / MAX_SPEED + 1.0);\n    return vec4(encode16bit(vel.x), encode16bit(vel.y));\n}\nvec2 decodeVelocity(vec4 texel) {\n    vec2 vel = vec2(decode16bit(texel.rg), decode16bit(texel.ba));\n    return (2.0 * vel - 1.0) * MAX_SPEED;\n}",E="attribute vec2 aCorner; //{0,1}x{0,1}\n\nvarying vec2 sampleCoords;\n\nvoid main(void) {\n    sampleCoords = aCorner;\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\n}",g=y;r(!1);var x=new p.a(E,"precision mediump float;\n\nuniform sampler2D uVel;\nuniform float uColorIntensity;\nuniform bool uBlacknWhite;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\n/*\n   /---__/     __\n 0 1 2 3 4\n*/\nfloat bump(float x) {\n  return min(mix(0.0, 1.0, clamp(x, 0.0, 1.0)),\n             mix(1.0, 0.0, clamp(x-3.0, 0.0, 1.0)));\n}\n\n/* Every hue, periodic with a period of 1 */\nvec3 color(float value) {\n    value *= 6.0;\n    float r = bump(mod(value-4.0, 6.0));\n    float g = bump(mod(value-0.0, 6.0));\n    float b = bump(mod(value-2.0, 6.0));\n    return vec3(r,g,b);\n}\n\nvoid main(void) {\n    vec2 vel = decodeVelocity(texture2D(uVel, sampleCoords)) / MAX_SPEED;\n\n    vec3 c = color(atan(vel.y, vel.x) / (2.0 * 3.14159));\n    c = mix(c, vec3(1), float(uBlacknWhite));\n\n    float intensity = smoothstep(0.0, 1.0, uColorIntensity*length(vel));\n\n    gl_FragColor = vec4(intensity * c, 1);\n}"),T=new p.a(E,"precision mediump float;\n\nuniform sampler2D uPressure;\nuniform float uColorIntensity;\nuniform bool uBlacknWhite;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\nvec3 color(float value) {\n    value = smoothstep(0.0, 1.0, clamp(value, 0.0, 1.0));\n    value = smoothstep(0.0, 1.0, value);\n\n    float r = smoothstep(.5, .75, value);\n    float g = min(smoothstep(.0, .25, value),\n                  1.0 - smoothstep(.75, 1.0, value));\n    float b = 1.0 - smoothstep(.25, .5, value);\n    return vec3(r,g,b);\n}\n\nvoid main(void) {\n    float pressure = decodePressure(texture2D(uPressure, sampleCoords));\n    pressure = pressure / MAX_PRESSURE;\n    pressure = clamp(256.0*uColorIntensity*pressure, -.5, .5) + 0.5;\n\n    vec3 c = color(pressure);\n    c = mix(c, vec3(pressure), float(uBlacknWhite));\n\n    gl_FragColor = vec4(c, 1);\n}"),P=new p.a("uniform vec2 uBrushSize; //relative, in [0,1]x[0,1]\nuniform vec2 uBrushPos; //relative, in [0,1]x[0,1]\n\nattribute vec2 aCorner; //{0,1}x{0,1}\n\nvarying vec2 sampleCoords;\nvarying vec2 toBrush;\n\nvoid main(void) {\n    sampleCoords = aCorner;\n    toBrush = (uBrushPos - aCorner) / uBrushSize;\n\n    gl_Position = vec4(2.0*aCorner - 1.0, 0.0, 1.0);\n}","precision mediump float;\n\nuniform sampler2D uVel;\n\nuniform vec2 uAddVel;\n\nvarying vec2 sampleCoords;\nvarying vec2 toBrush;\n\n___ENCODING___\n\nvoid main(void) {\n    vec2 vel = decodeVelocity(texture2D(uVel, sampleCoords));\n\n    float influence = 1.0 - clamp(length(toBrush), 0.0, 1.0);\n    vec2 toAdd = influence * uAddVel;\n\n    vel += toAdd;\n    vel *= min(1.0, MAX_SPEED / length(vel));\n\n    gl_FragColor = encodeVelocity(vel);\n}"),O=new p.a(E,"precision mediump float;\n\nuniform sampler2D uQuantity; //thing to advect\nuniform sampler2D uVel;\n\nuniform vec2 uVelUnit;\nuniform float uDt;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\nvoid main(void) {\n    vec2 vel = decodeVelocity(texture2D(uVel, sampleCoords));\n    vec2 pos = sampleCoords - uDt * vel * uVelUnit;\n    gl_FragColor = texture2D(uQuantity, pos);\n}"),I=new p.a(E,"precision mediump float;\n\nuniform sampler2D uPrevIter; //x\nuniform sampler2D uConstantTerm; //b\nuniform sampler2D uObstacles;\n\nuniform float uAlpha;\nuniform float uInvBeta;\n\nuniform vec2 uTexelSize;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\nvoid main(void) {\n    vec2 obstacle = decodeObstacle(texture2D(uObstacles, sampleCoords));\n    vec2 coords = sampleCoords + uTexelSize * obstacle;\n\n    float result = decodePressure(texture2D(uPrevIter, coords - vec2(uTexelSize.x,0))) +\n                   decodePressure(texture2D(uPrevIter, coords + vec2(uTexelSize.x,0))) +\n                   decodePressure(texture2D(uPrevIter, coords - vec2(0,uTexelSize.y))) +\n                   decodePressure(texture2D(uPrevIter, coords + vec2(0,uTexelSize.y)));\n\n    result += uAlpha * decodeDivergence(texture2D(uConstantTerm, coords));\n    result *= uInvBeta;\n    result = clamp(result, MIN_PRESSURE, MAX_PRESSURE);\n\n    gl_FragColor = encodePressure(result);\n}"),R=new p.a(E,"precision mediump float;\n\nuniform sampler2D uVelocity;\n\nuniform vec2 uTexelSize;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\nvoid main(void) {\n    vec2 top =    decodeVelocity(texture2D(uVelocity, sampleCoords + vec2(0,uTexelSize.y)));\n    vec2 bottom = decodeVelocity(texture2D(uVelocity, sampleCoords - vec2(0,uTexelSize.y)));\n    vec2 left =   decodeVelocity(texture2D(uVelocity, sampleCoords - vec2(uTexelSize.x,0)));\n    vec2 right =  decodeVelocity(texture2D(uVelocity, sampleCoords + vec2(uTexelSize.x,0)));\n\n    float div = ((right.x - left.x) + (top.y - bottom.y));\n    div *= min(1.0, MAX_DIVERGENCE / length(div));\n\n    gl_FragColor = encodeDivergence(div);\n}"),S=new p.a(E,"precision mediump float;\n\nuniform sampler2D uVelocities;\nuniform sampler2D uPressure;\n\nuniform vec2 uTexelSize;\nuniform float uHalfInvDx;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\nvoid main(void) {\n    float top =    decodePressure(texture2D(uPressure, sampleCoords + vec2(0,uTexelSize.y)));\n    float bottom = decodePressure(texture2D(uPressure, sampleCoords - vec2(0,uTexelSize.y)));\n    float left =   decodePressure(texture2D(uPressure, sampleCoords - vec2(uTexelSize.x,0)));\n    float right =  decodePressure(texture2D(uPressure, sampleCoords + vec2(uTexelSize.x,0)));\n\n    vec2 grad = uHalfInvDx * vec2(right - left, top - bottom);\n\n    vec2 partialVel = decodeVelocity(texture2D(uVelocities, sampleCoords));\n    vec2 divFreeVel = partialVel - grad;\n    divFreeVel *= min(1.0, MAX_SPEED / length(divFreeVel));\n\n    gl_FragColor = encodeVelocity(divFreeVel);\n}"),w=new p.a(E,"precision mediump float;\n\nuniform sampler2D uVelocities;\nuniform sampler2D uObstacles;\n\nuniform vec2 uTexelSize;\n\nvarying vec2 sampleCoords;\n\n___ENCODING___\n\nvoid main(void) {\n    vec2 obstacle = decodeObstacle(texture2D(uObstacles, sampleCoords));\n    vec2 coords = sampleCoords + obstacle * uTexelSize;\n\n    vec2 vel = decodeVelocity(texture2D(uVelocities, coords));\n    vel *= sign(0.5 - dot(obstacle,obstacle));\n\n    gl_FragColor = encodeVelocity(vel);\n}")}]);